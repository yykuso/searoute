export const detailDrawer=document.getElementById("detail-drawer");export const detailDrawerContent=document.getElementById("detail-drawer-content");export const detailDrawerTitle=document.getElementById("detail-drawer-title");export const detailDrawerCloseBtn=document.getElementById("detail-drawer-close-btn");export const SIDEBAR_SNAP={minHeight:72,midRatio:.3,maxRatio:.8,midThreshold:.18,maxThreshold:.55};export function showDetailDrawer(e,t="詳細情報",a=""){detailDrawerContent.innerHTML=e,detailDrawerContent.scrollTop=0,a?detailDrawerTitle.innerHTML=`<div><span>${t}</span><span class="block text-xs text-slate-500 font-normal leading-tight mt-0.5">${a}</span></div>`:detailDrawerTitle.textContent=t,setupNavigationTouchControl(),window.innerWidth>=768?(detailDrawer.classList.remove("md:-translate-x-full","hidden","translate-y-full"),detailDrawer.style.padding="",detailDrawer.style.pointerEvents="auto",detailDrawer.style.zIndex=1e3,detailDrawer.getBoundingClientRect()):(detailDrawer.classList.remove("translate-y-full","hidden"),detailDrawer.style.transition="max-height 0.3s, height 0.3s, padding 0.3s",detailDrawer.style.maxHeight="0px",detailDrawer.style.height="0px",detailDrawer.style.padding="0px",detailDrawer.style.zIndex=1e3,detailDrawer.getBoundingClientRect(),requestAnimationFrame(()=>{detailDrawer.classList.add("max-h-[30vh]"),detailDrawer.classList.remove("max-h-1/2"),detailDrawer.style.maxHeight=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",detailDrawer.style.padding="0",detailDrawer.style.pointerEvents="auto",detailDrawerContent&&(detailDrawerContent.style.overflowY="hidden",detailDrawerContent.style.maxHeight="100%",detailDrawerContent.style.paddingLeft="1rem",detailDrawerContent.style.paddingRight="1rem",detailDrawerContent.style.paddingTop="0",detailDrawerContent.style.paddingBottom="0.5rem")}))}export function hideDetailDrawer(){window.innerWidth>=768?(detailDrawer.classList.add("md:-translate-x-full"),setTimeout(()=>detailDrawer.classList.add("hidden"),300),detailDrawer.style.padding=""):(detailDrawer.style.transition="max-height 0.3s, height 0.3s, padding 0.3s",detailDrawer.style.maxHeight="0px",detailDrawer.style.height="0px",detailDrawer.style.padding="0px",setTimeout(()=>{detailDrawer.classList.add("hidden"),detailDrawer.style.padding="1rem"},300)),window.removeLongPressMarker&&window.removeLongPressMarker(),window.removeRouteHighlight&&window.removeRouteHighlight()}export function minimizeDetailDrawer(){detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.transition="max-height 0.3s, height 0.3s",detailDrawer.style.maxHeight=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",detailDrawerContent&&(detailDrawerContent.style.overflowY="hidden",detailDrawerContent.style.maxHeight="100%")}export function setDetailDrawerHeight(e){detailDrawer.style.maxHeight=e+"px",detailDrawer.style.height=e+"px"}export function resetDetailDrawerHeight(){detailDrawer.style.maxHeight="",detailDrawer.style.height=""}detailDrawerCloseBtn&&detailDrawerCloseBtn.addEventListener("click",hideDetailDrawer),window.addEventListener("mousedown",e=>{detailDrawer.classList.contains("hidden")||detailDrawer.contains(e.target)||window.innerWidth<768&&minimizeDetailDrawer()}),window.addEventListener("touchstart",e=>{detailDrawer.classList.contains("hidden")||detailDrawer.contains(e.target)||window.innerWidth<768&&minimizeDetailDrawer()},{passive:!0}),window.addEventListener("resize",()=>{detailDrawer.classList.contains("hidden")||(window.innerWidth>=768?detailDrawer.classList.remove("translate-y-full"):detailDrawer.classList.remove("md:-translate-x-full"))});let startY=0,startHeight=0,isDragging=!1,isMaybeDragFromScrollTop=!1;detailDrawer.addEventListener("touchstart",e=>{if(window.innerWidth>=768)return;if(1!==e.touches.length)return;if(isNavigationElement(e.target))return;const t=window.innerHeight,a=detailDrawer.offsetHeight,i=document.getElementById("detail-drawer-content");if(Math.abs(a-SIDEBAR_SNAP.maxRatio*t)<16&&i&&(e.target===i||i.contains(e.target))){const t=i.scrollTop;return isMaybeDragFromScrollTop=t<=0,isDragging=!1,startY=e.touches[0].clientY,void(startHeight=detailDrawer.offsetHeight)}isDragging=!0,isMaybeDragFromScrollTop=!1,startY=e.touches[0].clientY,startHeight=detailDrawer.offsetHeight,detailDrawer.style.transition="none",detailDrawer.style.overflowY="hidden",detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.pointerEvents="auto"},{passive:!1}),detailDrawer.addEventListener("touchmove",e=>{if(isNavigationElement(e.target))return;const t=window.innerHeight,a=detailDrawer.offsetHeight,i=document.getElementById("detail-drawer-content");if(Math.abs(a-SIDEBAR_SNAP.maxRatio*t)<16&&i&&(e.target===i||i.contains(e.target))){const t=i.scrollTop,a=e.touches[0].clientY-startY;if(!isDragging&&isMaybeDragFromScrollTop&&t<=0&&a>8)isDragging=!0,startY=e.touches[0].clientY,startHeight=detailDrawer.offsetHeight,detailDrawer.style.transition="none",detailDrawer.style.overflowY="hidden",detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.pointerEvents="auto";else if(!isDragging)return}if(!isDragging)return;e.preventDefault();const r=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0;let n=SIDEBAR_SNAP.maxRatio*window.innerHeight-r;const s=startY-e.touches[0].clientY;setDetailDrawerHeight(Math.min(n,Math.max(SIDEBAR_SNAP.minHeight,startHeight+s)))},{passive:!1}),detailDrawer.addEventListener("touchend",()=>{if(!isDragging)return;isDragging=!1,detailDrawer.style.transition="max-height 0.3s, height 0.3s";const e=window.innerHeight,t=detailDrawer.offsetHeight,a=document.getElementById("detail-drawer-content"),i=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0;if(t>e*SIDEBAR_SNAP.maxThreshold){detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2");const t=SIDEBAR_SNAP.maxRatio*e-i;detailDrawer.style.maxHeight=t+"px",detailDrawer.style.height=t+"px",detailDrawer.style.overflowY="hidden",a&&(a.style.overflowY="auto",a.style.maxHeight="calc(100% - 56px - env(safe-area-inset-top) - env(safe-area-inset-bottom))")}else t>e*SIDEBAR_SNAP.midRatio?(detailDrawer.classList.add("max-h-[30vh]"),detailDrawer.classList.remove("max-h-1/2"),detailDrawer.style.maxHeight=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",a&&(a.style.overflowY="hidden",a.style.maxHeight="100%")):(detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.maxHeight=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",a&&(a.style.overflowY="hidden",a.style.maxHeight="100%"))},{passive:!1});const sidebarGrip=document.getElementById("sidebar-grip");sidebarGrip&&(sidebarGrip.addEventListener("touchstart",gripDragStart,{passive:!1}),sidebarGrip.addEventListener("mousedown",gripDragStart,!1));let gripDragging=!1,gripStartY=0,gripStartHeight=0;function gripDragStart(e){window.innerWidth>=768||(gripDragging=!0,"touchstart"===e.type?(gripStartY=e.touches[0].clientY,document.addEventListener("touchmove",gripDragMove,{passive:!1}),document.addEventListener("touchend",gripDragEnd,{passive:!1})):(gripStartY=e.clientY,document.addEventListener("mousemove",gripDragMove,!1),document.addEventListener("mouseup",gripDragEnd,!1)),gripStartHeight=detailDrawer.offsetHeight,detailDrawer.style.transition="none",detailDrawer.style.overflowY="hidden",detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.pointerEvents="auto",e.preventDefault())}function gripDragMove(e){if(!gripDragging)return;let t=e.touches?e.touches[0].clientY:e.clientY;const a=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0;let i=SIDEBAR_SNAP.maxRatio*window.innerHeight-a,r=gripStartY-t;setDetailDrawerHeight(Math.min(i,Math.max(SIDEBAR_SNAP.minHeight,gripStartHeight+r))),e.preventDefault()}function gripDragEnd(e){if(!gripDragging)return;gripDragging=!1,detailDrawer.style.transition="max-height 0.3s, height 0.3s";const t=window.innerHeight,a=detailDrawer.offsetHeight,i=document.getElementById("detail-drawer-content"),r=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0;if(a>t*SIDEBAR_SNAP.maxThreshold){detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2");const e=SIDEBAR_SNAP.maxRatio*t-r;detailDrawer.style.maxHeight=e+"px",detailDrawer.style.height=e+"px",detailDrawer.style.overflowY="hidden",i&&(i.style.overflowY="auto",i.style.maxHeight="calc(100% - 56px - env(safe-area-inset-top) - env(safe-area-inset-bottom))")}else a>t*SIDEBAR_SNAP.midRatio?(detailDrawer.classList.add("max-h-[30vh]"),detailDrawer.classList.remove("max-h-1/2"),detailDrawer.style.maxHeight=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${100*SIDEBAR_SNAP.midRatio}dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",i&&(i.style.overflowY="hidden",i.style.maxHeight="100%")):(detailDrawer.classList.remove("max-h-[30vh]","max-h-1/2"),detailDrawer.style.maxHeight=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.height=`calc(${SIDEBAR_SNAP.minHeight}px + env(safe-area-inset-bottom))`,detailDrawer.style.overflowY="hidden",i&&(i.style.overflowY="hidden",i.style.maxHeight="100%"));document.removeEventListener("mousemove",gripDragMove,!1),document.removeEventListener("mouseup",gripDragEnd,!1),document.removeEventListener("touchmove",gripDragMove,{passive:!1}),document.removeEventListener("touchend",gripDragEnd,{passive:!1})}function isNavigationElement(e){return!!(e.classList.contains("cursor-pointer")||e.classList.contains("hover:text-blue-600")||e.closest(".cursor-pointer"))||(!(!e.hasAttribute("onclick")&&!e.closest("[onclick]"))||!("A"!==e.tagName&&!e.closest("a")))}function setupNavigationTouchControl(){detailDrawerContent.querySelectorAll(".cursor-pointer, [onclick], a").forEach((e,t)=>{e.addEventListener("touchstart",function(e){e.stopPropagation()},{passive:!0}),e.addEventListener("touchmove",function(e){e.stopPropagation()},{passive:!0}),e.addEventListener("touchend",function(e){e.stopPropagation()},{passive:!0})})}